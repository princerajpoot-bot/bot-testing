name: Tools preview on PR level

on:
  pull_request_target:
    types:
      - synchronize
      - edited

jobs:
  suggestChanges:
    if: github.repository == 'princerajpoot20/bot-testing'
    env:
        GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
    runs-on: ubuntu-latest
    steps:
        - name: Checkout repository
          uses: actions/checkout@v3
        - name: Use Node.js ${{ matrix.node-version }}
          uses: actions/setup-node@v3
          with:
            node-version: 16.x
        - name: Install dependencies
          run: npm install
        - name: Regenerate
          run: npm run generate:tools

        - name: Suggest changes
          run: |
            git diff > changes.diff
            if [[ -s changes.diff ]]; then
              # Adding suggestions with changes
              gh pr review ${{ github.event.pull_request.number }} --comment -b "Changes based on the regeneration: \n\n\`\`\`diff\n$(cat changes.diff)\n\`\`\`"
            fi
          env:
            GH_TOKEN: ${{ secrets.GH_TOKEN }}
